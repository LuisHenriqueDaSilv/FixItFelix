.data
#Musica
CONTADOR_NOTAS: .word 0
TEMPO_ULTIMA_NOTA: .word 0
TEMPO_REST: .word 0

# Wreck it Ralph
# TAMANHO: 48
# NOTAS: 60,234,59,234,60,234,55,351,48,351,55,468,60,234,59,234,60,234,55,351,50,351,48,468,60,234,59,234,60,234,55,351,48,351,55,468,60,234,59,234,60,234,55,351,48,351,50,468,60,234,59,234,60,234,55,351,48,351,55,468,60,234,59,234,60,234,55,351,50,351,48,468,60,234,59,234,60,234,55,351,48,351,55,468,60,234,59,234,60,234,55,351,48,351,50,234

# Ducktales:
# TAMANHO: 98
# NOTAS: 60,246,60,82,60,246,60,82,64,328,60,328,53,328,53,328,57,328,60,328,60,164,60,328,60,164,64,328,60,328,64,328,65,328,64,328,60,328,60,328,62,164,62,164,62,328,64,328,66,328,64,328,62,328,64,328, 72,328,72,574,72,82,79,328,76,328,60,328,64,246,67,82,69,328,72,328,71,328,68,328,71,328,72,328,71,328,68,328,71,328,72,328,72,574,72,82,79,328,76,656,75,82,74,82,72,82,69,328,72,410,71,328,68,328,71,328,72,328,71,328,68,328,71,328, 60,335,64,335,67,335,69,335,71,335,71,167,69,335,67,167,65,335,65,502,64,837,65,502,64,837,60,335,64,335,67,335,69,335,71,335,71,167,69,335,67,167,65,335,71,502,69,837,71,502,69,1172,62,335,65,335,69,335,69,502,67,1172,69,335,72,335,74,335,76,502,74,837

# #Back to black
# TAMANHO: 168
# NOTAS: 60,605,62,121,60,121,59,121,60,484,60,484,60,847,60,363,60,484,60,2178,60,484,60,484,60,484,58,484,60,1210,55,242,60,484,55,484,60,484,55,968,59,3146,60,363,59,121,60,2178,60,484,60,484,60,484,58,484,60,1936,60,484,60,484,60,363,58,605,60,1210,55,242,60,484,55,242,60,726,60,968,59,3146,60,363,59,121,60,968,58,242,60,242,58,242,60,726,60,242,60,484,60,968,60,1936,60,484,58,242,60,968,60,121,60,1331,55,242,60,484,55,484,60,484,55,968,59,3146,55,242,60,363,59,121,60,1210,58,242,60,726,58,242,60,484,60,484,58,484,60,1936,60,484,60,484,60,968,60,1452,60,484,55,484,60,363,55,121,55,726,60,242,59,1936, 62,484,64,363,62,605,65,242,64,242,64,726,62,242,64,968,62,484,64,484,62,484,65,242,64,242,64,2178,64,484,64,242,62,484,65,484,64,242,64,726,62,242,62,968,60,968,59,968,55,1694,64,363,64,363,62,726,65,242,64,363,64,605,62,242,64,968,62,484,64,484,62,484,65,242,64,242,64,2178,64,484,64,242,62,484,65,484,64,242,64,726,62,242,62,726,60,242,60,726,59,242,59,726,55,242,55,968, 48,726,48,242,48,726,48,242,48,726,48,484,46,484,43,242,41,726,41,242,41,726,29,242,41,726,41,484,42,484,43,242,45,726,45,242,45,726,33,242,45,726,45,484,40,484,45,242,43,726,43,242,43,968,43,726,43,484,46,484,47,242

# Happy
TAMANHO: 38
NOTAS: 55,185,60,185,60,370,60,370,55,185,55,185,55,185,59,185,59,185,60,370,48,370,52,370,53,370,52,185,55,370,53,370,52,370,48,185,52,370, 55,187,60,187,60,375,60,375,55,187,55,187,55,187,59,187,59,187,60,3749,64,187,64,375,64,375,64,562,55,187,55,187,57,187,59,187,60,937


.text

TOCA_MUSICA:
	csrr t0,time
	la t1,TEMPO_ULTIMA_NOTA
	lw t1,0(t1)
	sub t0,t0,t1
	la t1,TEMPO_REST
	lw t1,0(t1)
	
	bgeu t0,t1,TOCA_NOTA #verifica se já passou o tempo necessario para tocar a nota
	ret
	
TOCA_NOTA:
	la t0,CONTADOR_NOTAS
	mv t2,t0
	la t1,TAMANHO	
	lw t0,0(t0)	#t0 = contador de notas
	lw t1,0(t1)	#t1 = tamanho
	
	bne t0,t1,DIFERENTE #verifica se o contador já passou do tamanho da musica
	sw zero,0(t2)
	
DIFERENTE:
	li t1,8
	mul t1,t0,t1 #ajusta  aposicao da nota
	
	la t3,NOTAS
	add t3,t3,t1
	
	addi sp,sp,-8
	sw t3,0(sp) #guarda a posicao da nota
	sw ra,4(sp)
	
	
	
	#ecall para tocar musica
	
	lw a0,0(t3) #pitch
	lw a1,4(t3) #duracao
	li a2,1 #4 #instrumento
	li a3,100 #volume
	li a7,31 #comentar
	ecall #comentar
	
	#funcao para tocar musica na placa
#	jal MIDI_SAVE #nao funciona no rars
	
	#recupera posicao nota
	
	lw t3,0(sp)
	lw ra,4(sp)
	addi sp,sp,8
	
	lw t4,4(t3)
	la t0,TEMPO_REST
	sw t4,0(t0)
	
	csrr t0,time
	la t1,TEMPO_ULTIMA_NOTA
	sw t0,0(t1)
	
	
	la t1,CONTADOR_NOTAS
	lw t2,0(t1)
	addi t2,t2,1
	sw t2,0(t1)
	
	ret
	